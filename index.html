<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="author" content="John Doe">

  
  

  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2015/09/12/hello-world/">Hello World</a></h1>
  

    <time datetime="2015-09-13T01:46:15.000Z">
  <span class="day">12</span><span class="month">Sep</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2015/06/15/shang-hai-hua-wei-zhi-xing/">2015华为软件编程大赛上海复赛之行</a></h1>
  

    <time datetime="2015-06-16T04:25:23.000Z">
  <span class="day">15</span><span class="month">Jun</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>###0x00 比赛介绍</p>
<blockquote>
<p>2015华为软件精英挑战赛（2015 Huawei Software Elite Challenge）是华为公司面向全国高校学生举办的大型软件竞赛，致力于让参赛学生充分感受软件设计和写好代码的魅力，验证用软件设计和编程解决问题的能力，并通过比赛增强实战实践和与人沟通、协作的能力。– <em>摘自官网</em></p>
</blockquote>
<p>今年5月，华为公司启动了2015华为软件精英挑战赛（以下简称比赛），比赛分八个赛区同时进行。比赛题目为编写德州扑克AI,选手们的AI程序在后台同桌竞技多场，每场600局。预赛阶段，每个赛区决出赛区32强，然后在各赛区现场参加复赛，每个赛区决出4强，进入全国32强决赛。我有幸参与了上海合肥赛区的复赛，见识了华为的“土豪”。</p>
<p>###0x01 集结号<br>华为软件赛从5月初启动，官方提供服务器程序。选手使用c/c++,python或者java编写赛手程序。在截至日期<del>5月30日24点</del>（后更改为6月2日24点）前，在官网提交程序。官方组委会的人在14号来到我校（中科大）进行了一场宣讲会兼答疑会。参加过答疑会之后我才正式开始写程序。花了一个星期完成基本框架，半个星期完成基础策略。闲话少叙，经过线上模拟赛和最后的初赛，我的程序有幸以第一轮第四，第二轮第三进入复赛。此时获得前往上海的车票。</p>
<p>###0x02 入住<br>6月11日下午，我们合肥的第一批12个小伙伴乘坐G<em>**</em>到达上海，妖老板亲自来接！（妖老板是谁？我们这群合肥的都是她的后宫团！）</p>
<p>到住的地方一看是五星级酒店。。。给我们这些学生，住五星级的地方，还是蛮大方的。看图</p>
<p><img src="/content/images/2015/06/P50613-190620.jpg" alt=""><br><img src="/content/images/2015/06/1434213819019.jpeg" alt=""><br>冰箱里的饮料<br><img src="/content/images/2015/06/1434213815858.jpeg" alt=""></p>
<p>楼下是有游泳池和网球场的，然后对我们并没有什么卵用，我们没有时间去玩。</p>
<p>不得不说华为就是土豪，后来了解到，大部分赛区都住的的五星级酒店。对于我们学生来说，这种待遇还是很nice的。</p>
<p>###0x03 比赛现场<br>比赛现场在上海交通大学闵行校区，早上9点半从宾馆出发，乘大巴十点左右到。大厅被布置成了这样。<br><img src="/content/images/2015/06/IMG_3080.JPG" alt=""><br>三楼赛场的样子<br><img src="/content/images/2015/06/IMG_3220.JPG" alt=""><br><img src="/content/images/2015/06/IMG_3246.JPG" alt=""><br>中间一圈都是一个人的队伍，往外是两个人组成的队伍，最外圈是三人队。</p>
<p>前台签到的两个美眉<br><img src="/content/images/2015/06/IMG_3190.JPG" alt=""><br>角落里的桌上足球和德州扑克，很好玩的！跟我住一起的小伙伴tiaotiao特别喜欢玩桌上足球。拉着我玩了好多把，我才不会承认我的球技确实不如他。<br><img src="/content/images/2015/06/IMG_3532.JPG" alt=""><br>德扑大师们的竞技<br><img src="/content/images/2015/06/IMG_3526.JPG" alt=""><br><img src="/content/images/2015/06/IMG_3522.JPG" alt=""><br>上午的主要活动是破冰，组织给提供了1到8共32张A4大小的扑克，抽到配对扑克的队伍分别负责介绍对方。当我抽到红桃7扭头那一刹那，赫然看到跟我住一块的tiaotiao小伙伴手中握着黑桃七，敢信？我们就这么又配上对了!当然我们都比较了解了，并不用花什么功夫就可以互相介绍了。<strong>郑重声明</strong>(严肃):我们不是CP.</p>
<blockquote>
<p>我还是更喜欢妹子，谁帮我介绍个妹子鼓励师.<br>–某非著名程序员</p>
</blockquote>
<p>事后，tiaotiao一直对我说很想要那张超大的扑克牌。华为的大哥大姐，能把那张超大的扑克牌给我们的tiaotiao一张么（=￣ω￣=）。</p>
<p>这么多的队伍，这么多的汉子们，boring。STOP!发现一对野生的妹子，营养高，咯嘣脆的野生纯妹子队伍“渣渣队”。好像是上海交大的，上合唯一一只全部由妹子组成的队伍，当然妹子能顶半边天。(请忽略走错了位置的牌子兄)<br><img src="/content/images/2015/06/IMG_3416.JPG" alt=""></p>
<p>午餐在上海交大的自助餐厅，华为已经费用全包，但是饭后从餐厅走出来的时候，看到墙上的价格，心里已经开始默默吐槽，嗞嗞，这价格，这性价比。<br><img src="/content/images/2015/06/IMG_3400.JPG" alt=""></p>
<p>主办方给参赛的队伍提供了一个下午的时间，可以现场改代码。当然，也可以去玩游戏。我当时一是无意夺名次，二是下午的时间不足以完成我策划的大改动。然后。。我陪tiaotiao玩桌上足球去了。并没有什么可圈可点的事情。</p>
<p>晚饭全是大鱼大肉，好像很好的样子。然后，我并不喜欢吃肉和海鲜(=_=)，望着一桌子的食物，我的心在流泪(T T)。</p>
<p>###0x04 颁奖仪式</p>
<p>晚上的颁奖仪式主办方又一次向我们炫耀了他们的财富。现场要抽32个魔方电源（没见过，据说值100软妹币），和4个高级无线键鼠套装（看了看别人的，是微软的人体工程学键鼠套装，官方说价值1000软妹币），中奖率据说四分之一。好像自己暴露了自己没有中奖的结局。。我从小参加过无数次抽奖，然后向来没有中奖的运气。</p>
<blockquote>
<p>我想起来小学时候的一件事。跟着我妈去参加广场上的抽奖，办的很浩大的样子，宣传也到位，印象中至少有几千人。一张两块，买了一百多张，只抽到几张两块的奖就算了。抽到写着“电饭锅”或者“热水壶”之类的文字都是大奖，我特么抽到一张“电热锅”，“电热锅”是什么鬼啊！！！主办方的说明上压根没有这个东西！我家人都比较老实，我也小，卖券的说我们没中，我们也就把它丢掉了。</p>
<p>我现在想想，当时那种活动，多半都是组办出来骗钱的了。</p>
</blockquote>
<p>说回比赛，颁奖现场的状况是这样的。<br><img src="/content/images/2015/06/IMG_3725.JPG" alt=""><br>我是那个双手支撑沉思的，很喜欢《EVA》中主角他爹双手支撑起来的犀利样子，眼镜后边是深不可测的智慧。</p>
<p>比赛分为两轮，第一轮大混战，随机组桌，比100场，取积分前8进入第二局。第二局比赛50场决出前四，也就是最后的赢家了。等待的过程中，主办方为避免无聊，组织一场答题守擂游戏。然后，不知道从哪冒出来一个说相声的，第一场守擂游戏就让我们捧腹大笑了好多次，就是下边穿黄衣服的哥们。我记得不太清具体事例了，有哪位还记得可以提醒我在这写上。</p>
<p><img src="/content/images/2015/06/IMG_3735.JPG" alt=""></p>
<p>区域32强的奖品是华为荣耀畅玩手环(市场价三百多)，也就说今天过来的都有。</p>
<p><img src="/content/images/2015/06/IMG_3763.JPG" alt=""></p>
<blockquote>
<p>上图中的那个妹子好漂亮啊！<br>——国内某非著名程序员评论</p>
</blockquote>
<p><img src="/content/images/2015/06/IMG_3754.JPG" alt=""></p>
<p>最后四个赢家的照片就不贴了，本博主也不在里边。也不贴最后的成绩了，本博主在预赛前写的程序取得了比我预料的要好的成绩。</p>
<p>对了，四强奖品是!每!人!一!个!荣耀P8手机，好想要啊！</p>
<p>比赛结束的时候，上海研究所的所长（好像是他吧）挑出来几局在第二回合的游戏现场回放，大概就是看经济曲线，找到最陡的变化吧。出现大幅变化，基本都是all in，然而以我看这几场里边并不是那么的精彩，比较一般。我认为最精彩不一定出现在经济抖动最大的地方，反而很可能淹没在平滑的曲线中。因为在比赛中，all in是比较常见，反而审视夺度的盖牌（弃牌）有时候反而是最精彩的。德扑的经典牌局，很多是勇敢弃牌，或者以高牌（不成任何牌型）取得大胜。<a href="http://www.zhihu.com/question/21451879" target="_blank" rel="external">这个链接</a>里有一些德州扑克的非常经典的牌局，更有一把KK起手却弃牌，因为猜到对手是AA。在预赛前的模拟赛中，我就曾在巨大的replay中找到过我的程序拼到后边勇敢弃牌的回放。</p>
<blockquote>
<p>有时候放弃才是胜利。</p>
</blockquote>
<p><img src="/content/images/2015/06/64551.jpeg" alt=""></p>
<p><em>从上海回来时，有一个小伙伴在火车站突然说，我们这趟出门玩的这么爽，一分钱都没花，非要去车站买个东西</em> ╮(╯▽╰)╭</p>
<p>###0xFF 感言<br>一开始的时候，我并没有什么信心能写出来的。首先，我本科一直是理科（大气科学），编程经验较少，其次，我事情比较多，一个人写程序。在那么多人参加的情况下，我觉得不太可能进入决赛。所以决赛的奖励我也仅仅扫了一眼，就没再看过。至于复赛的名次我都没想，我只是打算随意写个程序去上海打个酱油，所以在复赛名单出来后，我近乎没动过代码（只是砍掉了初赛时为了求稳进入前四所加的行动以及逗比的行动）。但是没想到我这菜鸟也拿到了去上海的资格。</p>
<p>复赛现场！我才知道复赛奖品是华为荣耀p8离我那么近！今天！今天！我才看到原来是决赛前八就至少有5万！！哪有卖后悔药的！给我来一打！！我要认真准备。</p>
<p>这便是这次上海之行的全部了，本文并没有涉及任何技术，我打算留在下一篇博文中，记录我为这次比赛准备的过程以及其中学到的知识。昨天，我收到华为hr陈先生的微信，告诉我我获得了一个去深圳的机会，虽然不参赛，但是和别人一起吃喝玩乐，同时获得这个机会的还有tiaotiao以及其他赛区的几个队伍。下月10号左右坐飞机前往深圳。这将是我第一次坐飞机和第一次去深圳这么南的地方，再加上第一次去上海，这么多的第一次就都给了华为。华为你还要我的哪些第一次，来拿就是。</p>
<p>最后的最后，是我们上合赛区的吉祥物压阵，就是我们群里的妖老板。她和她的伙伴，给我们提供了很多的帮助，经常为了比赛忙到半夜才回家。妖老板人美，又可爱，身材又好，人又萌，世上有两种女孩最可爱，一种是漂亮；一种是聪慧，妖老板是聪明的漂亮女孩。(请放心，我没有被绑架)。感谢妖老板和她的伙伴们。<del>最近她快要结婚了，祝福她。</del>之前由于误传，没有快结婚这回事，祝妖老板早日成家。</p>
<p>妖老板的美丽，有诗为证。</p>
<blockquote>
<p>云想衣裳花想容，春风拂槛露华浓。<br>若非群玉山头见，会向瑶台月下逢。<br><img src="/content/images/2015/06/949187264933276649.jpg" alt=""></p>
</blockquote>
<p>妖老板强烈要求我po一张全宇宙最美的！我认真挑选下边这张，妖老板在其中辣么的璀璨夺目。<br><img src="/content/images/2015/06/51b8393cbec6286560.jpg" alt=""></p>

    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/生活-编程/">
- 生活
- 编程</a></div>

      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2015/05/01/meteorshi-yong-xian-you-de-mongodbshu-ju-ku/">Meteor使用现有的mongodb数据库</a></h1>
  

    <time datetime="2015-05-01T18:26:30.000Z">
  <span class="day">1</span><span class="month">May</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>meteor使用环境变量MONGO_URL确定mongodb的位置。如果已经存在一个监听在27017端口上的mongdb，则可以使用下边的一句话使用现有的mongodb。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> MONGO_URL=mongodb:<span class="comment">//localhost:27017/your_db</span></span><br></pre></td></tr></table></figure></p>
<p>将其中的your_db替换成你要使用的数据库。每次重开一个终端或主机重启的时候，环境变量会还原，需要重新导入。</p>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2015/05/01/zi-mu-zhuan-huan-da-xiao-xie/">字母转换大小写</a></h1>
  

    <time datetime="2015-05-01T16:04:20.000Z">
  <span class="day">1</span><span class="month">May</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>在ASCII码中，大写字母A-Z的编码是41h-5Ah,小写字母a-z的编码是61h-8Ah,中间相差20h，用二进制表示就是0010 0000。所以当从大写转换成小写或者从小写转换到大写的时候只需改变一位即可。可以用位操作很快的实现。</p>
<p>c语言示例代码<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//小写转换成大写</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">upper</span><span class="params">(<span class="keyword">char</span> input)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> input &amp; <span class="number">0xdf</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//大写转换成小写</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">lower</span><span class="params">(<span class="keyword">char</span> input)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> input | <span class="number">0x20</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//大小写转换,大写变小写，小写变大写。</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">reverse</span><span class="params">(<span class="keyword">char</span> input)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> input ^ <span class="number">0x20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2014/12/17/vim-tutorial/">Vim tutorial</a></h1>
  

    <time datetime="2014-12-17T15:47:47.000Z">
  <span class="day">17</span><span class="month">Dec</span>
</time>
  </header>
  <div class="entry-content">
    
      <p><em>写在前边</em><br>请忽略<strong>任何</strong>将VIM配置成类似Notepad编辑器的建议（Please ignore anyone who provides advice on how to configure Vim to operate like Notepad!）</p>
<p>####编辑<br>Vim中有Normal(普通)，Insert（编辑）和Visual（视图），在Insert模式下进行编辑。从普通模式进入编辑模式的快捷键：</p>
<ul>
<li>i 在光标当前位置插入</li>
<li>a 在光标当前位置之后插入</li>
<li>I 在当前行起始位置插入</li>
<li>A 在当前行末尾插入</li>
<li>o 在当前行下方插入新的行</li>
<li>O 在当前行上方插入一行</li>
<li>s 删除当前位置的字符并在此插入</li>
<li>S 删除当前行并进入编辑模式</li>
<li>cw 替换当前位置的单词并进入编辑 (any movement command can be substituted for w)</li>
<li>cc 同S (change line)</li>
<li>C 删除从光标位置到行尾的单词并进入编辑模式</li>
</ul>
<p>####保存并退出<br>在普通模式下使用 <code>:q</code>退出不保存，<code>:w</code>保存，<code>:w &lt;filename&gt;</code>保存问<filenmae>,<code>:wq</code>或<code>:x</code>保存并退出</filenmae></p>
<ul>
<li>:wa    write all changed files (save all changes)</li>
<li>:xa    exit all (save all changes and close Vim)</li>
<li>:qa    quit all (close Vim, but not if there are unsaved changes)</li>
<li>:qa!    quit all (close Vim without saving—discard any changes)</li>
</ul>
<hr>
<p><em>reference:</em></p>
<ul>
<li><a href="http://vim.wikia.com/wiki/Tutorial" target="_blank" rel="external">http://vim.wikia.com/wiki/Tutorial</a></li>
</ul>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2014/12/09/vim-xue-xi-bi-ji-shi-yong-biao-qian-lan/">Vim 学习笔记-使用tab分页（1）</a></h1>
  

    <time datetime="2014-12-09T15:29:30.000Z">
  <span class="day">9</span><span class="month">Dec</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>###使用tab分页<br>下边的的内容会介绍利用tab分页打开和编辑文件。在Vim中，所有文本都被放在缓存区，每一个缓存区都可以被显示在任意数量的窗口或任意数量的tab页面中（就像谷歌浏览器的标签页，以下将用tab描述）。</p>
<p>在很多编辑器中（不包括Vim）,一个文件只能在一个分页中打开，而每一个分页只能显示一个文件，一个文件不能出现在多个分页中。在Vim中并没有这个限制。Vim中的tabs可以很方便的组织你的工作。  </p>
<p>(本文将省略Gvim的说明)</p>
<hr>
<p>####打开和关闭tabs<br>当打开Vim的时候，可以指定-p参数，使得每个文件在各自的tab中显示（直到设定的上限tabpagemax）。例如：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim -<span class="tag">p</span> first<span class="class">.txt</span> second<span class="class">.txt</span></span><br><span class="line">gvim -<span class="tag">p</span> *.txt</span><br></pre></td></tr></table></figure></p>
<p>当Vim被启动后，可以使用下边的命令创建和关闭文件<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:tabedit</span> &#123;file&#125;   <span class="comment">#在一个新的tab中编辑file文件</span></span><br><span class="line"><span class="symbol">:tabfind</span> &#123;file&#125;   <span class="comment">#在‘path'变量中搜索指定文件file,并在新的tab中打开</span></span><br><span class="line"><span class="symbol">:tabclose</span>         <span class="comment">#关闭当前的tab</span></span><br><span class="line"><span class="symbol">:tabclose</span> &#123;i&#125;     <span class="comment">#关闭第i个tab</span></span><br><span class="line"><span class="symbol">:tabonly</span>          <span class="comment">#关闭除当前tab外的所有tab</span></span><br></pre></td></tr></table></figure></p>
<p>==:tabfind== 命令会使用Vim中的==’path’==选项最顶搜索的路径。例如下边的例子中。==.==会使Vim搜索当前文件所在的目录，然后搜索当前目录（两个连续的逗号==,,==），接着搜索当前目录的子目录(==**==)<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:set path=.,,**</span><br></pre></td></tr></table></figure></p>
<p>记住，就像Vim中的很多命令一样，你只要输入足够多的字符使Vim分辨出来你的命令就可以了。例如，你可以用==:tabe==和==:tabf==来代替==:tabedit==和==:tabfind==</p>
<p>另外，由于Vim中有大量的关于窗口的操作命令，在这些命令前加上tab就可以是这些命令变成对tab的操作。例如：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:tab ball         #show each buffer in a tab (up to 'tabpagemax' tabs) （我现在也不是很懂）</span><br><span class="line">:tab help         #在它自己的tab页打开help文件</span><br><span class="line">:tab drop &#123;file&#125;  #为file打开一个新的tab, 如果已经存在，就跳转到它所在的窗口或tab</span><br><span class="line">:tab split        #将当前文件完全复制到另外一个新的tab中</span><br></pre></td></tr></table></figure></p>
<p>使用==:sp myfile.txt==类似的命令可以再当前的tab中打开一个新的窗口(即将当前页面分裂成两个窗口)。可以使用命令==Ctrl-w T==将那个窗口移动到一个新的tab, 也可以在不改变原来页面的情况下，使用==:tab sp==将那个窗口复制的另外一个页面。</p>
<p>你可以使用==Ctrl-W c==关闭当前窗口，如果这个窗口已经是当前tab的最后一个窗口，这个tab也会被关闭。</p>
<p>如果你现在编辑的文件中含有另外一个文件的名字，你可以将光标移动文江名上，然后按==gf==去编辑那个文件。使用==Ctrl-W gf==会让该文件显示在一个新的tab中。</p>
<hr>
<p>####导航<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:tabs</span>         <span class="comment">#显示所有的tab，包括它们中的窗口</span></span><br><span class="line"><span class="symbol">:tabm</span> <span class="number">0</span>       <span class="comment">#将当前tab移动到第一个</span></span><br><span class="line"><span class="symbol">:tabm</span>         <span class="comment">#将当前tab移动到最后一个</span></span><br><span class="line"><span class="symbol">:tabm</span> &#123;i&#125;     <span class="comment">#将当前tab移动到第i+1个</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">:tabn</span>         <span class="comment">#切换到下个tab</span></span><br><span class="line"><span class="symbol">:tabp</span>         <span class="comment">#切换到上个tab</span></span><br><span class="line"><span class="symbol">:tabfirst</span>     <span class="comment">#切换到第一个tab</span></span><br><span class="line"><span class="symbol">:tablast</span>      <span class="comment">#切换到最后一个tab</span></span><br></pre></td></tr></table></figure></p>
<p>在常规模式(命令视图)中，可以使用这些快捷键：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">gt</span>            <span class="comment">#切换到下个tab</span></span><br><span class="line">gT            <span class="comment">#切换到上个tab</span></span><br><span class="line"><span class="string">&#123;i&#125;</span><span class="keyword">gt</span>         <span class="comment">#切换到第i个tab</span></span><br></pre></td></tr></table></figure></p>
<p>记住gt命令是从1开始计数。0gt和1gt都会跳到第一个tab。</p>
<hr>
<p>####捷径<br>下边这些内容需要添加到vimrc文件中，可以得到一些关于tab操作的快捷键。（我省略了暂时没看）</p>
<p>With the following mappings (which require gvim), you can press Ctrl-Left or Ctrl-Right to go to the previous or next tabs, and can press Alt-Left or Alt-Right to move the current tab to the left or right.<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nnoremap &lt;<span class="constant">C-Left&gt;</span> <span class="symbol">:tabprevious&lt;CR&gt;</span></span><br><span class="line">nnoremap &lt;<span class="constant">C-Right&gt;</span> <span class="symbol">:tabnext&lt;CR&gt;</span></span><br><span class="line">nnoremap &lt;silent&gt; &lt;<span class="constant">A-Left&gt;</span> <span class="symbol">:execute</span> <span class="string">'silent! tabmove '</span> . (tabpagenr()-<span class="number">2</span>)&lt;<span class="constant">CR&gt;</span></span><br><span class="line">nnoremap &lt;silent&gt; &lt;<span class="constant">A-Right&gt;</span> <span class="symbol">:execute</span> <span class="string">'silent! tabmove '</span> . tabpagenr()&lt;<span class="constant">CR&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>With the following, you can press F8 to show all buffers in tabs, or to close all tabs (toggle: it alternately executes :tab ball and :tabo).<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let notabs = <span class="number">0</span></span><br><span class="line">nnoremap &lt;silent&gt; &lt;<span class="constant">F8</span>&gt; <span class="symbol">:let</span> notabs=!notabs&lt;<span class="constant">Bar</span>&gt;<span class="symbol">:if</span> notabs&lt;<span class="constant">Bar</span>&gt;<span class="symbol">:tabo&lt;Bar&gt;</span><span class="symbol">:else&lt;Bar&gt;</span><span class="symbol">:tab</span> ball&lt;<span class="constant">Bar</span>&gt;<span class="symbol">:tabn&lt;Bar&gt;</span><span class="symbol">:endif&lt;CR&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>The following command abbreviation allows typing :tabv myfile.txt to view the specified file in a new tab; the buffer is read-only and nomodifiable so you cannot accidentally change it.<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cabbrev</span> tabv <span class="keyword">tab</span> <span class="keyword">sview</span> +<span class="keyword">setlocal</span>\ nomodifiable</span><br></pre></td></tr></table></figure></p>
<p>Refrence:<a href="http://vim.wikia.com/wiki/Using_tab_pages" target="_blank" rel="external">http://vim.wikia.com/wiki/Using_tab_pages</a></p>

    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/vim/">
- vim</a></div>

      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2014/12/08/vim-xue-xi-bi-ji-1/">Vim 学习笔记-复制和粘贴</a></h1>
  

    <time datetime="2014-12-08T16:37:08.000Z">
  <span class="day">8</span><span class="month">Dec</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>最近随着在linux下工作的时间越来越多，Vim的使用次数也越来在越多。以前曾经掌握的基本操作本来就不多，后来又忘掉了很多，现在越来越感觉会的快捷键不够用了，导致编辑效率不高。所以现在每天花点时间重新学些Vim的东西吧。</p>
<hr>
<p>###复制和粘贴</p>
<p><strong>剪切（复制）和粘贴</strong>  </p>
<ol>
<li>将光标移动到剪切的开头部分</li>
<li>按<strong>v</strong>开始选择字符（按住<strong>V</strong>选择整行）</li>
<li>将光标移动到希望剪切部分的尾部。</li>
<li>按<strong>d</strong>剪切（按<strong>y</strong>复制）</li>
<li>移动到希望粘贴的地方</li>
<li>按<strong>P</strong>粘贴到光标前，按<strong>p</strong>粘贴到光标之后  </li>
</ol>
<blockquote>
<p><em>tips:</em><br> <strong>d</strong> = delete = cut<br> <strong>y</strong> = yank = copy</p>
<hr>
<p>###多段粘贴</p>
</blockquote>
<p>当删除或者复制一段文字的时候，这段文字被保存在Vim的未命名寄存器中。Vim中还可以使用用单个字母标记的命名寄存器。用一个双引号加一个字母指定要使用的寄存器。  </p>
<p>例如，选择==hello==后，按==”ay==将”hello”保存到==a==寄存器，然后选择==world==,按==”by==保存到==b==寄存器。当要粘贴的时候，分别使用==”ap==和==”bp==粘贴”hello”和”world”。当然也可以使用==”aP==和==”bP==来粘贴到光标之前。</p>
<p>####在不同Vim窗口（或终端）中粘贴<br>在复制文本后，为了复制到另一个文件，先打开一个缓冲区：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:e</span> ~<span class="regexp">/dummy</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>将文本粘贴到缓冲区</li>
<li>保存缓冲区的内容(:w)</li>
<li>切换到前一个缓冲区以释放交换文件*.swp</li>
<li>现在可以换到另外一个窗口或者终端</li>
<li>将光标移动到希望粘贴的地方</li>
<li>读取dummy文件(:r ~/dummy)  </li>
</ul>
<hr>
<p>###增加缓冲区大小</p>
<p>在Vim中有时候最多只能复制50行。可以通过增加缓存区大小来解除这个限制：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:<span class="operator"><span class="keyword">help</span> <span class="string">'viminfo'</span></span><br><span class="line">...</span><br><span class="line">&lt;       Maximum <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">lines</span> saved <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">register</span>.</span><br><span class="line">...</span><br><span class="line">:<span class="keyword">set</span> viminfo?</span><br><span class="line">:<span class="keyword">set</span> viminfo=<span class="string">'100,&lt;100,s10,h</span></span></span><br></pre></td></tr></table></figure></p>

    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/vim/">
- vim</a></div>

      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2014/12/07/fen-xi-500pxde-apibing-qie-zhi-zuo-ge-pa-chong/">用python制作一个简单爬虫下载500px的图片</a></h1>
  

    <time datetime="2014-12-07T16:37:46.000Z">
  <span class="day">7</span><span class="month">Dec</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>500px.com是一个专业的摄影图片社区，在500px上可以发现和分享高质量的图片，它的Logo是“最出色的摄影社区”。我在他的网站上找到很多喜爱的图片。但是，当你发现自己喜爱的图片然后右键的时候，糟糕，提示“copyright blabla”,反正就是不让下载。今天，我在这里记录我分析他的API，并且用python自动抓取图片的过程。</p>
<p>####获得图片<br>500px阻止了右键下载的功能，当然，突破这个限制很简单，只要在chrome浏览器里开启调试模式，然后在Elements里搜索”jpg”，就可以找到下载地址。它的下载地址是这样一个形式的。可以很轻松的找到需要的下载地址。<br><img src="/content/images/2014/12/QQ--20141208004913.png" alt="图片"></p>
<p>获得一张图片的地址，还不够，我还想写个脚本自动抓取它的图片，本来以为像平常一样简单，但是真正去抓的时候，却遇到点麻烦。</p>
<p>####动态网站？怎么抓<br>我在获得popular页（popular页是所有图片的开始）的数据之后，使用正则表达式搜索其中的链接，奇怪是没有找到任何图片链接，因为我学python做爬虫也没多久，所以我并不知道是怎么回事。我把抓过来的页面写到文件里，然后用编辑器打开。突然恍然大悟。推荐页面的图片都是动态加载的。必须在浏览器里运行javascript后才能得到目标页面。但是我的爬虫过于简陋显然是没办法运行javascript的，也就谈不上抓取真正想要数据。  </p>
<p>现在怎么办？动态页面？我没有办法，只好向室友请教（室友是个经验丰富的大牛）。他告诉我，我需要webkit。 嗯。又学到了一个新东西。他就帮我google，发现了pyv8。让我去看看。  </p>
<p>pyv8，竟然还有python的V8引擎，好东西。可是我不会用。。。我这会有搜索了一下其他的webkit。知道了没有界面的headless webkit是我想要的东西，其中PhantomJS 是一个非常好的webkit。但是我要用python，PhantomJs 是javascript的，我看到一些在python里使用PhantomJs的方法，也尝试了一下。但是在安装阶段，卧槽，莫名其妙的错误（写博客的时候已经忘了当时什么错误了，反正玩linux经常回出现各种莫名其妙的错误）。blalba， 在webkit这块折腾了许久，没搞定，其中还发现了Ghost这么一个包，可以直接来抓动态网页，好厉害，可是我用的python3，在我机器上没有安装成功。  </p>
<p>一顿折腾，我打算放弃的时候，想到在知乎上好像看到一个方法“找到网站的API,直接获取数据”。接下来就是进入分析阶段了。</p>
<p>####获得json数据</p>
<p>首先还要进入浏览器的调试模式，进入500px的推荐页面。看到过程是下边这样的。<br><img src="/content/images/2014/12/QQ--20141208011307.png" alt="数据传送过程">  </p>
<p>可以看到，一开始获得“没有价值的”首页，然后出现一个ping ，看到ping的地址，就马上知道这就是我们的目标了。记下来都是获得的各种css和js文件。继续往下看，发现在开始获取图片资源以前又get了一次api请求。<br><img src="/content/images/2014/12/QQ--20141208011616.png" alt=""></p>
<p>这时候点开这个请求，发现是个json数据，经过观察，就是首页推荐里的所有图片的信息。<br><img src="/content/images/2014/12/QQ--20141208011658.png" alt=""></p>
<p>这时候的目标就很简单了，看给Api发出的请求，然后伪造请求。<br><img src="/content/images/2014/12/QQ--20141208011710.png" alt=""></p>
<p>在试了几次之后，发现其中的auth-token是很重要的，否则就请求一定会被拒绝。但是auth-token从哪里来，cookie里没有，找啊找，最后发现auth-token就在首页的head区域中。  </p>
<p>接下来的过程自然就是获取推荐页，获得auth-token，然后伪造请求向api发数据（我还模仿浏览器先ping了一下），从json中获得图片的下载链接。在处理json时，用Python3自带的json处理包可以很方便的处理数据。这里有意思的是，它发回的json包里的下载地址都是4.jpg结尾，但是把4改成5之后，获得的图片就比较更清晰（实际上因为高清原图都要买，我还没法弄到）。</p>
<p>由于学python还没多久，所以编程上还不是很好，后来想将程序改成一个class，也遇到困难，干脆不做了，毕竟只是一个用用就不用的脚本，不是当做产品的。</p>
<p>我的代码：  </p>
<pre><code><span class="comment"># a python program to grap 500pk and download pictures</span>
<span class="comment"># author: Aaron</span>
<span class="comment"># 3 Feb 2014</span>

<span class="keyword">import</span> urllib.request
<span class="keyword">import</span> urllib.parse
<span class="keyword">import</span> re
<span class="keyword">import</span> http.cookiejar
<span class="keyword">import</span> time
<span class="keyword">import</span> json
<span class="keyword">import</span> pickle
<span class="keyword">import</span> os
<span class="keyword">import</span> os.path
<span class="keyword">import</span> queue

BASE_URL = <span class="string">'https://500px.com/'</span>
START_URL = <span class="string">'https://500px.com/popular'</span>
<span class="comment">#API = "https://api.500px.com/v1/photos?rpp=38&amp;feature=popular&amp;image_size%5B%5D=3&amp;image_size%5B%5D=4&amp;\</span>
<span class="comment">#page="+page+"&amp;sort=&amp;include_states=true&amp;formats=jpeg%2Clytro&amp;only=&amp;authenticity_token="</span>
API_BASE = <span class="string">"https://api.500px.com/v1/photos?"</span>
Cauth_token = <span class="string">'A%2Be7bNn8RWMGBFySgzumEk3AZhzqXQ0JPs3zUScmm0%3D'</span>
API_PING = <span class="string">'https://api.500px.com/v1/ping'</span>
SAVE_PATH = <span class="string">'./image/'</span>

query = {<span class="string">'rpp'</span>: [<span class="string">'38'</span>],
         <span class="string">'feature'</span>: [<span class="string">'popular'</span>],
         <span class="string">'image_size[]'</span>: [<span class="string">'3'</span>, <span class="string">'4'</span>],
         <span class="string">'page'</span>: [<span class="string">'1'</span>],
         <span class="string">'sort'</span>: [<span class="string">''</span>],
         <span class="string">'include_states'</span>: [<span class="string">'true'</span>], 
         <span class="string">'formats'</span>: [<span class="string">'jpeg,lytro'</span>],
         <span class="string">'only'</span>: [<span class="string">''</span>],              <span class="comment">#category, leave blank for all.</span>
         <span class="string">'authenticity_token'</span>: [<span class="string">''</span>]
         }
start = <span class="number">1</span>
end = <span class="number">10</span>

visited = []
wait_list = queue.Queue()


<span class="comment">#build opener</span>
cj = http.cookiejar.CookieJar()
opener = urllib.request.build_opener(urllib.request.HTTPCookieProcessor(cj))
opener.addheaders = [(<span class="string">'User-Agent'</span>,<span class="string">' Mozilla/5.0 (Windows NT 6.3; Win64; x64)\
                     AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.122 Safari/537.36'</span>)]

<span class="function"><span class="keyword">def</span> <span class="title">get_token</span><span class="params">(taget_url)</span>:</span>
    <span class="keyword">with</span> opener.open(taget_url) <span class="keyword">as</span> f:
        data = f.read().decode()
        <span class="comment">#print(data)</span>
        pattern = <span class="string">'&lt;a data-bind="photo_link" data-ga-action="Image" data-ga-category="Photo Thumbnail" href="\S*" id="\S*"&gt;'</span>
        test_pat = <span class="string">'href="\S*"'</span>
        test_data = re.search(test_pat,data)
        print(test_data.group())
        pic_reg = re.compile(pattern)
        res = pic_reg.search(data)
        print(res)
        auth_patt = <span class="string">'content="(?P&lt;auth_token&gt;\S*)".name="csrf-token"'</span>
        auth = re.search(auth_patt,data)
        print(<span class="string">'auth'</span>,auth.group(<span class="string">'auth_token'</span>))
        auth_token = auth.group(<span class="string">'auth_token'</span>)
    save_file = open(<span class="string">'test.html'</span>,<span class="string">'w+'</span>)
    save_file.write(data)
    save_file.close()
    <span class="keyword">return</span> auth_token

<span class="function"><span class="keyword">def</span> <span class="title">save_image</span><span class="params">(image)</span>:</span>
    <span class="keyword">pass</span>

<span class="function"><span class="keyword">def</span> <span class="title">get_image</span><span class="params">(photo)</span>:</span>
    <span class="string">'''
    get and save the image
    '''</span>
    image_url = photo[<span class="string">'image_url'</span>][<span class="number">1</span>]
    image_id = photo[<span class="string">'id'</span>]
    image_category = photo[<span class="string">'category'</span>]
    path = SAVE_PATH + str(image_category)+<span class="string">'/'</span>
    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):
        os.mkdir(path)
    <span class="keyword">with</span> opener.open(image_url) <span class="keyword">as</span> res:
        image = res.read()
        <span class="keyword">with</span> open(path+str(image_id)+<span class="string">'.jpg'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> file:
            file.write(image)
        file.close()
        <span class="comment">#print(photo_id,'is ok')</span>

<span class="function"><span class="keyword">def</span> <span class="title">ping</span><span class="params">()</span>:</span>
    opener.addheaders = [(<span class="string">'Origin'</span>,<span class="string">'https://500px.com'</span>),(<span class="string">'Referer'</span>,<span class="string">'https://500px.com/popular'</span>)]
    opener.open(API_PING)

<span class="function"><span class="keyword">def</span> <span class="title">get_list</span><span class="params">(API)</span>:</span>
    <span class="keyword">global</span> wait_list
    <span class="keyword">global</span> visited
    print(<span class="string">"reading list"</span>)
    <span class="keyword">with</span> opener.open(API) <span class="keyword">as</span> f:
        json_data = f.read().decode()
    pic_list = json.loads(json_data)
    <span class="keyword">for</span> photo <span class="keyword">in</span> pic_list[<span class="string">'photos'</span>]:
        <span class="keyword">if</span> photo[<span class="string">'id'</span>] <span class="keyword">not</span> <span class="keyword">in</span> visited:
            photo[<span class="string">'image_url'</span>][<span class="number">1</span>] = photo[<span class="string">'image_url'</span>][<span class="number">1</span>].replace(<span class="string">'4.jpg'</span>,<span class="string">'5.jpg'</span>)
            wait_list.put(photo)
    print(<span class="string">'dowloaded:'</span>,len(visited))
    print(<span class="string">'to be dowloaded:'</span>,wait_list.qsize())
    json_file = open(<span class="string">'pics.json'</span>,<span class="string">'w+'</span>)
    json_file.write(json_data)
    json_file.close()

<span class="function"><span class="keyword">def</span> <span class="title">handle_wait_list</span><span class="params">(page)</span>:</span>
    total = wait_list.qsize()
    count = <span class="number">0</span>
    <span class="keyword">while</span> <span class="keyword">not</span> wait_list.empty():
        photo = wait_list.get()
        get_image(photo)
        count = count + <span class="number">1</span>
        percentage = <span class="number">100.0</span>*count/total
        print(<span class="string">"%.1f%% is done on this page %d"</span> %(percentage,page))
        id = photo[<span class="string">'id'</span>]
        visited.append(photo[<span class="string">'id'</span>])

<span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(page)</span>:</span>    
    print(<span class="string">'Dolowding page: '</span>,page)
    query[<span class="string">'page'</span>] = [str(page),]
    API = API_BASE + urllib.parse.urlencode(query,doseq=<span class="keyword">True</span>)
    ping()
    print(<span class="string">'Reading list on page %d.'</span> %page)
    get_list(API) 
    print(<span class="string">'Starting download the images.'</span>)
    handle_wait_list(page)
    print(<span class="string">'Page %d is handled successfully.'</span> %page)
    save_visited()

<span class="function"><span class="keyword">def</span> <span class="title">save_visited</span><span class="params">()</span>:</span>
    <span class="keyword">with</span> open(<span class="string">'visited'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:
        pickle.dump(visited,f)

<span class="function"><span class="keyword">def</span> <span class="title">load_visited</span><span class="params">()</span>:</span>
    <span class="keyword">global</span> visited
    print(<span class="string">'Starting...'</span>)
    <span class="keyword">with</span> open(<span class="string">'visited'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:
        visited = pickle.load(f)
    <span class="comment">#print(visited)</span>

<span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span>
    <span class="keyword">try</span>:
        load_visited()
    <span class="keyword">except</span> Exception <span class="keyword">as</span> err:
        print(err)
    auth_token = get_token(START_URL)
    query[<span class="string">'authenticity_token'</span>] = [auth_token,]
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="keyword">for</span> page <span class="keyword">in</span> range(start,end):
            get_page(page)
        time.sleep(<span class="number">600</span>)


<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    <span class="keyword">try</span>:
        main()
    <span class="keyword">except</span> KeyboardInterrupt:
        print(<span class="string">'Exiting, please wait'</span>)
        save_visited()
    <span class="comment">#except Exception as err:</span>
    <span class="comment">#    print('Somthing is wrong. Exiting...')</span>
    <span class="comment">#    print(err)</span>
</code></pre>
    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2014/12/02/da-hua-tong-bu-yi-bu-zu-sai-fei-zu-sai/">大话同步/异步、阻塞/非阻塞</a></h1>
  

    <time datetime="2014-12-02T12:13:57.000Z">
  <span class="day">2</span><span class="month">Dec</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>原文作者：<em>李博杰</em> 原文地址:<a href="https://bojieli.com/2014/11/sync-async-blocked/" target="_blank" rel="external">https://bojieli.com/2014/11/sync-async-blocked/</a> (转载请注明出处)  </p>
<p>好多人搞不清这两组概念之间的区别。我们拿小明下载文件打个比方。</p>
<ol>
<li><strong>同步阻塞</strong>：小明一直盯着下载进度条，到 100% 的时候就完成。</li>
<li><strong>同步非阻塞</strong>：小明提交下载任务后就去干别的，每过一段时间就去瞄一眼进度条，看到 100% 就完成。</li>
<li><strong>异步阻塞</strong>：小明换了个有下载完成通知功能的软件，下载完成就“叮”一声。不过小明仍然一直等待“叮”的声音（看起来很傻，不是吗）</li>
<li><strong>异步非阻塞</strong>：仍然是那个会“叮”一声的下载软件，小明提交下载任务后就去干别的，听到“叮”的一声就知道完成了。<br>也就是说，同步/异步是下载软件的通知方式，或者说 API 被调用者的通知方式。阻塞/非阻塞则是小明的等待方式，或者说 API 调用者的等待方式。</li>
</ol>
<p>在不同的场景下，同步/异步、阻塞/非阻塞的四种组合都有应用。</p>
<p>###同步阻塞</p>
<p>同步阻塞是最简单的方式，就像我们在 C 语言里调用一个函数并等待其返回。</p>
<p><img src="https://bojieli.com/wp-content/uploads/2014/11/99880254f7298bc9d8f9e57a4033584a.png" alt=""></p>
<p>如 stat 系统调用获取文件元数据，只有同步阻塞一种模式。我在访问量很大的一个文件服务器（mirrors.ustc.edu.cn）上遇到过大量 nginx 进程处于 D（uninterruptible）状态的问题，就是因为 stat 系统调用不提供非阻塞 I/O（O_NONBLOCK）选项（nginx 在能用非阻塞 I/O 的地方都用了非阻塞）。文件的元数据被从磁盘中读入进来的时间里，这个 nginx worker 进程只能在内核态苦苦等待而无法做其他事。不提供 O_NONBLOCK 选项，对内核开发者来说这是省事了，但对用户来说就要付出性能的代价了。</p>
<p>###同步非阻塞</p>
<p>同步非阻塞就是 “每隔一会儿瞄一眼进度条” 的轮询（polling）方式。</p>
<p>![] (<a href="https://bojieli.com/wp-content/uploads/2014/11/99880254f7298bc9d8f9e57a4033584a.png" target="_blank" rel="external">https://bojieli.com/wp-content/uploads/2014/11/99880254f7298bc9d8f9e57a4033584a.png</a>)</p>
<p>同步非阻塞方式相比同步阻塞方式：</p>
<ul>
<li>优点是能够在等待任务完成的时间里干其他活了（包括提交其他任务，也就是 “后台” 可以有多个任务在同时执行）。</li>
<li>缺点是任务完成的响应延迟增大了，因为每过一段时间才去轮询一次，而任务可能在两次轮询之间的任意时间完成。</li>
</ul>
<p>由于同步非阻塞方式需要不断轮询，而 “后台” 可能有多个任务在同时进行，人们就想到了循环查询多个任务的完成状态，只要有任何一个任务完成，就去处理它。这就是所谓的 “I/O 多路复用”。UNIX/Linux 下的 select、poll、epoll 就是干这个的（epoll 比 poll、select 效率高，做的事情是一样的）。Windows 下则有 WaitForMultipleObjects 和 IO Completion Ports API 与之对应（Windows API 的命名简直甩 POSIX API 几条街有木有！）</p>
<p><img src="https://bojieli.com/wp-content/uploads/2014/11/f4cabe69f04985ee5042782628517d69.png" alt=""></p>
<center>Linux I/O 多路复用</center>

<p>高并发的程序一般使用同步非阻塞方式而非多线程 + 同步阻塞方式。要理解这一点，首先要扯到并发和并行的区别。比如去某部门办事需要依次去几个窗口，办事大厅里的人数就是并发数，而窗口个数就是并行度。也就是说并发数是指同时进行的任务数（如同时服务的 HTTP 请求），而并行数是可以同时工作的物理资源数量（如 CPU 核数）。通过合理调度任务的不同阶段，并发数可以远远大于并行度，这就是区区几个 CPU 可以支持上万个用户并发请求的奥秘。在这种高并发的情况下，为每个任务（用户请求）创建一个进程或线程的开销非常大。而同步非阻塞方式可以把多个 I/O 请求丢到后台去，这就可以在一个进程里服务大量的并发 I/O 请求。</p>
<p>###异步非阻塞</p>
<p>异步非阻塞，就是把一件事丢到 “后台” 去做，完成之后再通知。</p>
<p><img src="https://bojieli.com/wp-content/uploads/2014/11/0909b4a6480a374239b4b76d1e6706ab.png" alt=""></p>
<p>在 Linux 中，通知的方式是 “信号”。</p>
<ul>
<li>如果这个进程正在用户态忙着做别的事（例如在计算两个矩阵的乘积），那就强行打断之，调用事先注册的信号处理函数，这个函数可以决定何时以及如何处理这个异步任务。由于信号处理函数是突然闯进来的，因此跟中断处理程序一样，有很多事情是不能做的，因此保险起见，一般是把事件 “登记” 一下放进队列，然后返回该进程原来在做的事。</li>
<li>如果这个进程正在内核态忙着做别的事，例如以同步阻塞方式读写磁盘，那就只好把这个通知挂起来了，等到内核态的事情忙完了，快要回到用户态的时候，再触发信号通知。</li>
<li>如果这个进程现在被挂起了，例如无事可做 sleep 了，那就把这个进程唤醒，下次有 CPU 空闲的时候，就会调度到这个进程，触发信号通知。<br>异步 API 说来轻巧，做来难，这主要是对 API 的实现者而言的。Linux 的异步 I/O（AIO）支持是 2.6.22 才引入的，还有很多系统调用不支持异步 I/O。Linux 的异步 I/O 最初是为数据库设计的，因此通过异步 I/O 的读写操作不会被缓存或缓冲，这就无法利用操作系统的缓存与缓冲机制。</li>
</ul>
<p>Windows API 里的异步 I/O API（被称为 Overlapped I/O）则优雅得多，可以在 ReadFileEx、WriteFileEx 等 I/O API 上指定回调函数，当 I/O 操作完成时就会调用它。这相当于在 “信号” 的基础上提供了一层封装。除了指定回调函数，这些异步 I/O 请求还可以使用 “传统” 的同步阻塞方式（WaitForSingleObject）、多路复用的同步非阻塞方式（WaitForMultipleObjects）来等待。多个异步 I/O 请求也可以绑定到一个 I/O Completion Port 上一起等待。</p>
<p><img src="https://bojieli.com/wp-content/uploads/2014/11/e16f432c28c595ef44879bdc0da39ecc.png" alt=""></p>
<center>Windows 异步 I/O 原理</center>

<p>很多人把 Linux 的 O_NONBLOCK 认为是异步方式，但事实上这是前面讲的同步非阻塞方式。由于 Linux 的异步 I/O 难用，nginx 早期版本一直使用的是 O_NONBLOCK 和 epoll，从 0.8.11 开始支持异步 I/O，但默认使用的仍然是同步非阻塞方式。需要指出的是，虽然 Linux 上的 I/O API 略显粗糙，但每种编程框架都有封装好的异步 I/O 实现。操作系统少做事，把更多的自由留给用户，正是 UNIX 的设计哲学，也是 Linux 上编程框架百花齐放的一个原因。</p>
<p>###异步阻塞</p>
<p>都有下载完成通知了，我还傻傻地盯着进度条干什么？这种看起来很傻的方式也是有用的。有时我们的 API 只提供异步通知方式，例如在 node.js 里，但业务逻辑需要的是做完一件事后做另一件事，例如数据库连接初始化后才能开始接受用户的 HTTP 请求。这样的业务逻辑就需要调用者是以阻塞方式来工作。</p>
<p>为了在异步环境里模拟 “顺序执行” 的效果，就需要把同步代码转换成异步形式，这称为 CPS（Continuation Passing Style）变换。BYVoid 大神的 continuation.js 库就是一个 CPS 变换的工具。用户只需用比较符合人类常理的同步方式书写代码，CPS 变换器会把它转换成层层嵌套的异步回调形式。</p>
<p><img src="https://bojieli.com/wp-content/uploads/2014/11/5c285ecb4fb48eb685a71e0303828e18.png" alt=""></p>
<center>CPS 变换后的异步代码示例（来源：continuation.js）</center>



<p><img src="https://bojieli.com/wp-content/uploads/2014/11/4ca101de8090224e15b1887ef509de2e.png" alt=""></p>
<center>用户手写的同步代码示例（来源：continuation.js）</center>

<p>另外一种使用阻塞方式的理由是<strong>降低响应延迟</strong>。如果采用非阻塞方式，一个任务 A 被提交到后台，就开始做另一件事 B，但 B 还没做完，A 就完成了，这时要想让 A 的完成事件被尽快处理（比如 A 是个紧急事务），要么丢弃做到一半的 B，要么保存 B 的中间状态并切换回 A，任务的切换是需要时间的（不管是从磁盘载入到内存，还是从内存载入到高速缓存），这势必降低 A 的响应速度。因此，对实时系统或者延迟敏感的事务，有时采用阻塞方式比非阻塞方式更好。</p>
<p>最后补充一句，同步/异步的概念在不同语境下是不同的，本文说的是 API 或者 I/O。在其他语境里可能是别的意思，例如分布式系统里的同步表示是各节点按照时钟节拍同步，而异步是收到消息后立即执行。  </p>
<p>转载自<a href="https://bojieli.com/2014/11/sync-async-blocked/" target="_blank" rel="external">https://bojieli.com/2014/11/sync-async-blocked/</a></p>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"><a href="/2014/12/02/ghost-blogan-zhuang-xiang-xi-guo-cheng/">ghost blog安装过程</a></h1>
  

    <time datetime="2014-12-02T11:13:53.000Z">
  <span class="day">2</span><span class="month">Dec</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>ghost blog是一个用node.js写成的开源博客平台，由前 WordPress UI 部门主管 John O’Nolan 和 WordPress 高级工程师（女） Hannah Wolfe 创立，目的是为了给用户提供一种更加纯粹的内容写作与发布平台。ghost blog现在有从zip压缩包安装，git安装和npm安装三种方式。其中从zip压缩包安装是最简单也是最快的的方式，本文主要讨论这种安装方式。</p>
<h4 id="从zip安装ghost程序">从zip安装ghost程序</h4><ol>
<li><p>ghost博客运行在node.js上，首先需要安装Node.js。可以从linux的包管理器安装node.js。<br>在ubuntu系统上，首先运行<br><code>curl -sL https://deb.nodesource.com/setup | sudo bash -</code><br>然后运行<br><code>sudo apt-get install -y nodejs</code><br>在debian操作系统上（root用户）:  </p>
<pre><code>apt-<span class="built_in">get</span> install cur
curl -sL http<span class="variable">s:</span>//<span class="keyword">deb</span>.nodesource.<span class="keyword">com</span>/setup | bash -
</code></pre><p>其他操作系统的安装方式见<a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager" target="_blank" rel="external">https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager</a>  </p>
</li>
<li><p><strong>安装ghost博客</strong>。</p>
<ul>
<li>使用下边的方式下载最新的gost<br><code>$ curl -L https://ghost.org/zip/ghost-latest.zip -o ghost.zip</code></li>
<li>解压缩下载的安装包<br><code>$ unzip -uo ghost.zip -d ghost</code></li>
<li>在解压缩下载的安装包后，在ghost目录下执行<br><code>npm install --production</code></li>
<li>使用下边的命令在developement 环境下启动ghost:<br><code>npm start</code> </li>
</ul>
</li>
<li><p><strong>配置反向代理服务器（推荐nginx)</strong>  </p>
<ul>
<li><p>建立文件<code>/etc/nginx/sites-available/ghost.conf</code>.其中添加如下内容：  </p>
<pre><code>server {
   listen <span class="number">80</span>;
   server_name example.com;  
   location / {
       proxy_set_header   X-Real-IP <span class="variable">$remote</span>_addr;
       proxy_set_header   Host      <span class="variable">$http</span>_host;
       proxy_pass         http://<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">2368</span>;
           }
  }
</code></pre></li>
<li>将example.com更改成你的域名    </li>
<li><p>在<code>/sites-enabled</code>下创建配置文件的软链接</p>
<pre><code>$ sudo ln -s <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-available/g</span>host.conf <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-enabled/g</span>host.conf
</code></pre></li>
<li>重新载入nginx文件<code>service nigix restart</code></li>
</ul>
</li>
</ol>

    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
</article>


<nav id="pagenavi">
  
  
    <a href="/page/2/" class="alignright next">下一頁</a>
  
  <div class="clearfix"></div>
</nav></div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2015 John Doe
  
</p>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>